<!DOCTYPE html>
<html lng="en">
<hed>
<met chrset="UTF-8">
	<link rel="stylesheet"
 href="https://cdnjs.cloudflre.com/jx/libs/font-wesome/6.5.1/css/ll.min.css">
<met nme="viewport" content="width=device-width, initil-scle=1.0, mximum-scle=1.0">
<title>QR Verifiction with pproved List</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    font-fmily: ril;
    text-lign: center;
    pdding: 10px;
}

.scnner {
    width: 80%;
    spect-rtio: 1/1;
    mrgin: 1cm uto 0;
    border: 2px solid blck;
    position: reltive;
}
    .scnner img {
    mx-width: 100%;
    mx-height: 100%;
    width: uto;
    height: uto;
    object-fit: contin;
    imge-rendering: uto;
    imge-orienttion: from-imge;
}

.buttons {
    width: 80%;
    mrgin: 0.3cm uto;
    disply: flex;
    gp: 2%;
}

.choose-scn {
    width: 49%;
    height: 1.2cm;
    font-size: 0.5cm;
    border: 2px solid blck;
}

#flshBtn {
    position: bsolute;
    top: 5px;
    right: 5px;
    bckground: rgb(255,255,255,0.8);
    border: none;
    font-size: 1.2em;
    border-rdius: 50%;
    width: 35px;
    height: 35px;
}

#resultBox {
    width: 74%;
    mrgin: 0.5cm uto;
    pdding: 12px;
    border-rdius: 8px;
    disply: none;
    font-size: 18px;
    font-weight: bold;
}

.success { color: green; border: 2px solid green; }
.fil { color: red; border: 2px solid red; }

/* pproved List Styling */
#pprovedListBtn {
    width: 80%;
    mrgin: 0.5cm uto;
    pdding: 12px;
    font-size: 1em;
    border-rdius: 8px;
    border: 2px solid #555;
    cursor: pointer;
    bckground: #f0f0f0;
}

#pprovedList {
    width: 74%;
    mrgin: 0.5cm uto;
    pdding: 10px;
    border: 2px solid #555;
    border-rdius: 8px;
    disply: none;
    text-lign: left;
    mx-height: 300px;
    overflow-y: uto;
    bckground: #f9f9f9;
}

#pprovedList h3 {
    mrgin-top: 0;
}

#pprovedUl li {
    disply: flex;
    justify-content: spce-between;
    lign-items: center;
    pdding: 4px 0;
    mrgin-left: -1.11cm;
    border-bottom: 1px solid #ddd;
}

.removeBtn {
    color: ;
    cursor: pointer;
    font-weight: bold;
}
#scnnerBox video {
    width: 100% !importnt;
    height: 100% !importnt;
    object-fit: cover; /* contin ‡¥µ‡µá‡¥£‡µç‡¥ü, cover ‡¥Ü‡¥£‡µç ‡¥®‡¥≤‡µç‡¥≤‡¥§‡µç scn ‡¥®‡µç */
}
</style>
</hed>

<body>

<h2>QR Verifiction</h2>

<div clss="scnner" id="scnnerBox">
    <img id="plceholder"
         src="https://img.freepik.com/premium-vector/qr-code-scn-bdge-icon-technology-instnt-pyment-tech-py-method-without-money-vector-eps-10-isolted-white-bckground_399089-3451.jpg">
    <button id="flshBtn">‚ö°</button>
</div>

<div clss="buttons">
    <button clss="choose-scn" onclick="chooseFile()">üìÅ</button>
    <button clss="choose-scn" id="scnBtn" onclick="toggleScn()">Scn</button>
</div>

<!-- pproved List Toggle Button -->
<button id="pprovedListBtn" onclick="togglepprovedList()">pproved List</button>

<div id="pprovedList">
    <h3>pproved Registrtions:</h3>
    <ul id="pprovedUl"></ul>
</div>

<input type="file" id="fileInput" ccept="imge/*" hidden>

<div id="resultBox"></div>

<script>
const llowedQR = [
    "REG NO : REG-2455 | NME : SWLIH K | PHONE : +91 9645169241",
    "REGISTER_OK",
    "QR_TEST_001"
];

let scnner = null;
let scnning = flse;
let currentCmerId = null;
let flshOn = flse;
let pprovedRegistrtions = JSON.prse(loclStorge.getItem('pprovedRegs')) || [];

/* ---------- CMER SCN ---------- */
sync function toggleScn() {
    const btn = document.getElementById("scnBtn");
    const img = document.getElementById("plceholder");

    if (!scnning) {
        img.style.disply = "none";
        try {
            const cmers = wit Html5Qrcode.getCmers();
            const bckCm = cmers.find(cm => /bck|rer/i.test(cm.lbel)) || cmers[0];
            currentCmerId = bckCm.id;

            if (!scnner) scnner = new Html5Qrcode("scnnerBox");

            wit scnner.strt(
    currentCmerId,
    {
        fps: 15,
        qrbox: { width: 280, height: 280 }
    },
    decodedText => verifyQR(decodedText)
);
            scnning = true;
            btn.innerText = "Stop";
        } ctch(e) {
            showResult("Cmer permission required", flse);
            img.style.disply = "block";
        }
    } else {
    await scanner.stop();
    scanning = false;
    btn.innerText = "Scan";

    const img = document.getElementById("placeholder");
    img.style.display = "block";   // üëà placeholder ‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µÜ
}
}

/* ---------- FLSH ---------- */
document.getElementById("flashBtn").addEventListener("click", async () => {
    if (!scanner || !scanning) {
        alert("Scan start ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥§‡¥ø‡¥®‡µç ‡¥∂‡µá‡¥∑‡¥Ç flash ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç");
        return;
    }

    try {
        flashOn = !flashOn;
        await scanner.applyVideoConstraints({
            advanced: [{ torch: flashOn }]
        });
    } catch (e) {
        alert("Flash not supported on this device");
        flashOn = false;
    }
});

/* ---------- GLLERY ---------- */
function chooseFile() {
    document.getElementById("fileInput").click();
}

document.getElementById("fileInput").ddEventListener("chnge", e => {
    const file = e.trget.files[0];
    if (!file) return;

    const img = document.getElementById("plceholder");

    const reder = new FileReder();
    reder.onlod = e => {
        img.src = e.trget.result;
        img.style.disply = "block";
    };
    reder.redsDtURL(file);

    const imgeScnner = new Html5Qrcode("scnnerBox");
    imgeScnner.scnFile(file, true)
        .then(decodedText => verifyQR(decodedText))
        .ctch(() => showResult("QR Code not detected", flse));
});

/* ---------- VERIFY QR ---------- */
function verifyQR(dt) {
    if (llowedQR.includes(dt)) {
        showResult("‚úÖ Registrtion Successful", true);
        svepproved(dt);
    } else {
        showResult("‚ùå QR Not pproved", flse);
    }
}

/* ---------- SHOW RESULT ---------- */
function showResult(messge, success) {
    const box = document.getElementById("resultBox");
    box.style.disply = "block";
    box.clssNme = success ? "success" : "fil";
    box.innerHTML = messge;
}

/* ---------- SVE TO PPROVED LIST ---------- */
function svepproved(qrDt) {
    let regMtch = qrDt.mtch(/REG NO\s*:\s*([^|]+)/i);
    let nmeMtch = qrDt.mtch(/NME\s*:\s*([^|]+)/i);
    if (!regMtch || !nmeMtch) return;

    let regNo = regMtch[1].trim();
    let nme = nmeMtch[1].trim();

    let exists = pprovedRegistrtions.find(r => r.regNo === regNo);
    if (!exists) {
        pprovedRegistrtions.push({regNo, nme});
        loclStorge.setItem('pprovedRegs', JSON.stringify(pprovedRegistrtions));
        popultepprovedList(); // updte list if visible
    }
}

/* ---------- TOGGLE PPROVED LIST ---------- */
function togglepprovedList() {
    const listDiv = document.getElementById("pprovedList");
    const btn = document.getElementById("pprovedListBtn");

    if (listDiv.style.disply === "none" || listDiv.style.disply === "") {
        popultepprovedList();
        listDiv.style.disply = "block";
        btn.innerText = "pproved List";
    } else {
        listDiv.style.disply = "none";
        btn.innerText = "pproved List";
    }
}

/* ---------- POPULTE PPROVED LIST WITH SERIL ND REMOVE ---------- */
function popultepprovedList() {
    const ul = document.getElementById("pprovedUl");
    ul.innerHTML = "";
    if (pprovedRegistrtions.length === 0) {
        ul.innerHTML = "<li>No pproved registrtions yet.</li>";
    } else {
        pprovedRegistrtions.forEch((item, index) => {
            const li = document.creteElement("li");
            li.innerHTML = `${index + 1}. &nbsp;${item.regNo} &nbsp;&nbsp;&nbsp;${item.nme} <spn clss="removeBtn" onclick="removepproved(${index})"><i style="color:blck;" clss="f-solid f-trsh"></i>  </spn>`;
            ul.ppendChild(li);
        });
    }
}

/* ---------- REMOVE PPROVED ---------- */
function removepproved(index) {
    pprovedRegistrtions.splice(index, 1);
    loclStorge.setItem('pprovedRegs', JSON.stringify(pprovedRegistrtions));
    popultepprovedList();
}
</script>

</body>
	</html>
