<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>QR Verification</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    font-family: Arial;
    text-align: center;
}
.scanner {
    width: 80%;
    aspect-ratio: 1/1;
    margin: 1cm auto 0;
    border: 2px solid black;
    position: relative;
}
.scanner img {
    width: 100%;
    aspect-ratio: 1/1;
    object-fit: contain;
}
.buttons {
    width: 80%;
    margin: 0.3cm auto;
    display: flex;
    gap: 2%;
}
.choose-scan {
    width: 49%;
    height: 1cm;
    font-size: 0.45cm;
}
</style>
</head>

<body>

<div class="scanner" id="scannerBox">
    <img id="placeholder"
     src="https://img.freepik.com/premium-vector/qr-code-scan-badge-icon-technology-instant-payment-tech-pay-method-without-money-vector-eps-10-isolated-white-background_399089-3451.jpg">
</div>

<div class="buttons">
    <button class="choose-scan" onclick="chooseFile()">Choose File</button>
    <button class="choose-scan" id="scanBtn" onclick="toggleScan()">Scan</button>
</div>

<input type="file" id="fileInput" accept="image/*" hidden>

<script>
const allowedQR = [
    "REG NO : REG-2455 | NAME : SWALIH K | PHONE : +91 9645169241",
    "REGISTER_OK",
    "QR_TEST_001"
];

let scanner = null;
let scanning = false;

/* ===== Toggle Scan / Stop ===== */
function toggleScan() {

    const btn = document.getElementById("scanBtn");
    const img = document.getElementById("placeholder");

    if (!scanning) {

        Html5Qrcode.getCameras().then(cams => {
            if (!scanner) {
                scanner = new Html5Qrcode("scannerBox");
            }

            img.style.display = "none";

            scanner.start(
                cams[0].id,
                { fps: 10, qrbox: 250 },
                onScanSuccess
            );

            scanning = true;
            btn.innerText = "Stop";

        }).catch(() => {
            alert("Camera permission required");
        });

    } else {

        scanner.stop().then(() => {
            scanning = false;
            btn.innerText = "Scan";
            img.style.display = "block";
        });
    }
}

/* ===== Scan Success ===== */
function onScanSuccess(text) {
    scanner.stop().then(() => {
        scanning = false;
        document.getElementById("scanBtn").innerText = "Scan";
        document.getElementById("placeholder").style.display = "block";
        verifyQR(text);
    });
}

/* ===== Choose File ===== */
function chooseFile() {
    document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        Html5QrcodeScanner.scanImage(reader.result, true)
            .then(verifyQR)
            .catch(() => alert("Invalid QR"));
    };
    reader.readAsDataURL(file);
});

/* ===== Verify ===== */
function verifyQR(data) {
    if (allowedQR.includes(data)) {
        alert("Registration Successful");
    } else {
        alert("QR Not Approved");
    }
}
</script>

</body>
</html>
